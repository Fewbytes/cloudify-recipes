# Generated by the Cloudify debug subsystem
echo "Loading the debug environment..."

#the cloudify environment variables for this event:
<% System.getenv().grep{it =~ /^(CLOUDIFY|USM|LOOKUP)/}.each {println("export ${it.key}")} %>

export CLOUDIFY_WORKDIR=${cloudifyWorkdir}
export SCRIPT_NAME=${scriptName}
export KEEPALIVE_FILE=${keepaliveFile}

cd $CLOUDIFY_WORKDIR
export JAVA_HOME=$HOME/java
export CLASSPATH=`find $HOME/gigaspaces/lib/{required,platform/cloudify} -name *.jar | paste -sd:`
export PATH=$HOME/gigaspaces/tools/groovy/bin:$PATH
chmod +x debug.groovy
chmod +x $SCRIPT_NAME


#set up shortcut aliases
[[ -f debug_commands ]] || (./debug.groovy | tail -n+2 >debug_commands)
for COMMAND in `grep -Eo "\-\-[^ ]*" debug_commands | cut -c3- `; do
    alias $COMMAND="$CLOUDIFY_WORKDIR/debug.groovy --$COMMAND"
done
#some special treatment for the help alias
alias help="cut -c7- <$CLOUDIFY_WORKDIR/debug_commands"

clear
PS1='Debugging[$SCRIPT_NAME]: '
echo -n "Starting a debugging session"
echo ": for hook $SCRIPT_NAME"
echo "These are the available debug commands:"
help #use our newly created alias
echo
